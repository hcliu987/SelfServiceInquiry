package com.hc.wx.mp.manual;

import com.hc.wx.mp.service.ResultStorageService;
import com.hc.wx.mp.service.UrlService;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;

/**
 * 手动测试短链接功能的工具类
 * 运行此类可以快速生成测试短链接
 */
@SpringBootApplication
@ComponentScan(basePackages = "com.hc.wx.mp")
public class ShortLinkManualTester {

    public static void main(String[] args) {
        SpringApplication.run(ShortLinkManualTester.class, args);
    }

    @Bean
    CommandLineRunner testShortLinkGeneration(ResultStorageService resultStorageService, UrlService urlService) {
        return args -> {
            System.out.println("=== 短链接功能手动测试 ===");
            
            // 测试数据集合
            String[] testContents = {
                "微信小程序开发相关链接:\nhttp://developers.weixin.qq.com\nhttps://github.com/wechat-miniprogram\n更多开发资源...",
                "Spring Boot 学习资源:\nhttps://spring.io/projects/spring-boot\nhttps://docs.spring.io/spring-boot/docs/current/reference/html/\n官方文档和教程",
                "Java 开发工具:\nhttps://www.oracle.com/java/\nhttps://openjdk.java.net/\n开发环境配置指南"
            };
            
            for (int i = 0; i < testContents.length; i++) {
                System.out.println("\n--- 测试 " + (i + 1) + " ---");
                
                // 存储结果
                String key = resultStorageService.storeResult(testContents[i]);
                System.out.println("生成的Key: " + key);
                
                // 生成URL
                String url = urlService.generateResultUrl(key);
                System.out.println("完整URL: " + url);
                
                // 验证存储
                String retrievedContent = resultStorageService.getResult(key);
                boolean isStored = retrievedContent != null && retrievedContent.equals(testContents[i]);
                System.out.println("存储验证: " + (isStored ? "✅ 成功" : "❌ 失败"));
                
                System.out.println("访问链接: curl " + url);
            }
            
            System.out.println("\n=== 测试完成 ===");
            System.out.println("可以通过浏览器访问上述URL来验证页面显示效果");
            System.out.println("或使用curl命令行工具进行测试");
        };
    }
}